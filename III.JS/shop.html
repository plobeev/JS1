<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style_shop.css">
    <script src="https://code.jquery.com/jquery-3.6.0.slim.js"
        integrity="sha256-HwWONEZrpuoh951cQD1ov2HUK5zA5DwJ1DNUXaM6FsY=" crossorigin="anonymous"></script>
    <title>Shop</title>
</head>

<body>
    <div class="main">
        <div id="items"></div>
        <div id="cart"></div>
        <div id="sum"></div>
    </div>
    <script>
        var products = [];

        function product(title, src) {
            this.title = title;
            this.src = src;
        }

        products.push(new product("Товар 1", 'p1.jpg'));
        products.push(new product("Товар 2", 'p2.jpg'));
        products.push(new product("Товар 3", 'p3.jpg'));
        products.push(new product("Товар 4", 'p4.jpg'));
        products.push(new product("Товар 5", 'p5.jpg'));
        products.push(new product("Товар 6", 'p6.jpg'));
        products.push(new product("Товар 7", 'p7.jpg'));

        for (var item of products) {
            item.count = 1;
            item.price = 100 * Math.round(Math.random() * 90 + 10);
        }



        for (var z = 0; z < products.length; z++) {
            div = document.createElement('div');
            div.setAttribute("id", "i" + (z + 1));
            div.setAttribute("class", "item");
            document.getElementById("items").append(div);

            span = document.createElement("span");
            span.innerText = "Наименование: " + products[z].title;
            span.setAttribute("class", "title");
            document.getElementById("i" + (z + 1)).append(span);

            span = document.createElement("span");
            span.innerText = "Цена: " + products[z].price;
            span.setAttribute("class", "price");
            document.getElementById("i" + (z + 1)).append(span);

            img = document.createElement("img");
            src = "small/" + products[z].src;
            img.setAttribute("onerror", "this.onerror=null;this.src='small/pn.jpg'");
            img.src = src;
            document.getElementById("i" + (z + 1)).append(img);

            button = document.createElement("button");
            button.innerText = "Добавить в корзину";
            button.setAttribute("class", "itemBtn");
            button.setAttribute("id", "b" + z);
            button.onclick = addToCart;
            document.getElementById("i" + (z + 1)).append(button);
        }

        var productsInCart = [];

        function addToCart(event) {

            var t = event.target.id.split("")[1];

            productsInCart.push(products[(event.target.id.split("")[1])]);

            div = document.createElement('div');
            div.setAttribute("id", "t" + (t));
            div.setAttribute("class", "item_cart");
            document.getElementById("cart").append(div);

            span = document.createElement("span");
            span.innerText = products[t].title;
            span.setAttribute("class", "title");
            document.getElementById("t" + t).append(span);

            span = document.createElement("span");
            span.innerText = "Цена: " + products[t].price;
            span.setAttribute("class", "price");
            document.getElementById("t" + t).append(span);

            document.getElementById("b" + t).disabled = true;
            document.getElementById("b" + t).innerText = 'Добавлено';

            buttonAdd = document.createElement("button");
            buttonAdd.innerText = "+";
            buttonAdd.setAttribute("class", "cart_btn_add");
            buttonAdd.setAttribute("id", "p" + t);
            buttonAdd.onclick = countPlus;
            document.getElementById("t" + t).append(buttonAdd);

            buttonRemove = document.createElement("button");
            buttonRemove.innerText = "-";
            buttonRemove.setAttribute("class", "cart_btn_remove");
            buttonRemove.setAttribute("id", "m" + t);
            buttonRemove.onclick = countMinus;
            document.getElementById("t" + t).append(buttonRemove);
            countBasketPrice(productsInCart);
        }


        function countPlus(e) {
            if (products[(e.target.id.split("")[1])].count >= 0) {
                products[(e.target.id.split("")[1])].count++;
                span = document.createElement("span");
                span.innerText = "Количество: " + products[(e.target.id.split("")[1])].count;
                span.setAttribute("class", "count" + (e.target.id.split("")[1]));
                $('.count' + (e.target.id.split("")[1])).remove();
                document.getElementById("t" + (e.target.id.split("")[1])).append(span);
            }
            countBasketPrice(productsInCart);
        }

        function countMinus(e) {
            if (products[(e.target.id.split("")[1])].count > 0) {
                products[(e.target.id.split("")[1])].count--;
                span = document.createElement("span");
                span.innerText = "Количество: " + products[(e.target.id.split("")[1])].count;
                span.setAttribute("class", "count" + (e.target.id.split("")[1]));
                $('.count' + (e.target.id.split("")[1])).remove();
                document.getElementById("t" + (e.target.id.split("")[1])).append(span);
            }
            countBasketPrice(productsInCart);
        }


        function countBasketPrice(arr) {
            var endPrice = 0;
            for (var item of arr) {
                endPrice = item.price * item.count + endPrice;
                console.log(item.title + " " + item.price + "$ ", item.count, endPrice);
            }
            endSum = document.createElement("span");
            endSum.innerText = "К оплате: " + endPrice;
            endSum.setAttribute("class", "endPrice");
            $('.endPrice').remove();
            document.getElementById("sum").append(endSum);
        }
    </script>
</body>

</html>